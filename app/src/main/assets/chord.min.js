jQuery(document).ready(function($) {
    build_chord();
    /*if ($('a.chord').length > 0) {
        var nada_dasar = clean_basic_tone($('a.chord').first().text());

        $('#switch-content').find('div[id="'+ nada_dasar +'"]').addClass('current-basic-tone');
        $('#switch-content').find('div').click(function () {
            transpose(clean_basic_tone($('a.chord').first().text()),$(this).text());
            $('#switch-content').find('.current-basic-tone').removeClass('current-basic-tone');
            $(this).addClass('current-basic-tone');
        });
    }*/
});
function clean_basic_tone(nada_dasar) {
    if (nada_dasar.length > 1 && nada_dasar.charAt(1) != '#') {
        $('#switch-content').find('div').each(function () {
            if (!$(this).hasClass('font-size-14')) {
                $(this).text($(this).text()+nada_dasar.substr(1));
                $(this).removeClass('font-size-18').addClass('font-size-14');
            }
        });
        nada_dasar = nada_dasar.charAt(0);
    }
    if (nada_dasar.length > 2 && nada_dasar.charAt(1) == '#') {
        nada_dasar = nada_dasar.charAt(0)+'#';
    }
    return nada_dasar;
}
function transpose(basic_tone,new_basic_tone) {
    var bobots = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
    var index_basic_tone = bobots.indexOf(basic_tone);
    var index_new_basic_tone = bobots.indexOf(clean_basic_tone(new_basic_tone));
    var transpose_val = (index_basic_tone - index_new_basic_tone)/2;
    $('a.chord').each(function () {
        var chord = $(this).text();
        var index = bobots.indexOf(chord);
        if (index < 0) {
            if (chord.length > 2) {
                if (chord.charAt(1) == '#') {
                    index = bobots.indexOf(chord.charAt(0)+chord.charAt(1));
                } else {
                    index = bobots.indexOf(chord.charAt(0));
                }
            } else if (chord.length == 2) {
                index = bobots.indexOf(chord.charAt(0));
            }
        }

        var selisih = index - transpose_val*2;
        if (selisih < 0) {
            selisih = bobots.length + selisih;
        } else {
            if (selisih > 11) {
                selisih = selisih - 12;
            }
        }

        var suffix = "";
        if (chord.length > 2) {
            suffix = chord.substr(1);
            if (chord.charAt(1) == '#') {
                suffix = chord.substr(2);
            }
        } else if (chord.length == 2) {
            if (chord.charAt(1) != '#') {
                suffix = chord.substr(1);
            }
        }

        var new_chord = bobots[selisih]+suffix;
        if (new_chord == 'E#')
            new_chord = 'F';
        if (new_chord == 'B#')
            new_chord = 'C';

        if ($(this).text().length > 0) {
            $(this).text(new_chord);
        }
        resetPosition();
    });
    onAfterTransposed();
}
function build_chord() {
    $('body').find('a').each(function () {
        $(this).addClass($(this).text());
    });
    resetPosition();
}
function resetPosition() {
    $('body').find('a').each(function () {
        if ($(this).parent()[0].nodeName.toLowerCase() == 'sup') {
            if ($(this).text().length > 0) {
                $(this).parent().attr('style', 'width:0px;height:0px;display:inline-block;');
            } else {
                $(this).parent().attr('style', 'width:20px;height:0px;display:inline-block;');
            }
        }
    });
}
function onAfterTransposed() {}
String.prototype.replaceAll = function (stringFind, stringReplace) {
    var ex = new RegExp(stringFind.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1"), "g");
    return this.replace(ex, stringReplace);
};